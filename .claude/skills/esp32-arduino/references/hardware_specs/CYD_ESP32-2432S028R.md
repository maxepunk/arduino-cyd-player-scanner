# CYD (Cheap Yellow Display) - ESP32-2432S028R Hardware Specifications

The CYD is an ESP32 development board with integrated 2.4" TFT display, touch screen, RGB LED, speaker output, and SD card slot.

## Board Overview

**Full Name:** ESP32-2432S028R (Dual USB: USB-C and Micro USB)

**Key Features:**
- ESP32 microcontroller
- 2.4" ILI9341 TFT display (240x320)
- XPT2046 resistive touch screen
- RGB LED (active low)
- Speaker amplifier output
- SD card slot (VSPI)
- Light sensor (LDR)

## Available GPIO Connectors

### P3 Connector (4P 1.25mm JST)

| Pin | Function | Notes |
|-----|----------|-------|
| GND | Ground | |
| IO35 | GPIO | **Input only**, no internal pull-ups |
| IO22 | GPIO | Also available on CN1 connector |
| IO21 | TFT Backlight | Not really usable (controls display backlight) |

### CN1 Connector (4P 1.25mm JST) - I2C Ready

| Pin | Function | Notes |
|-----|----------|-------|
| GND | Ground | |
| IO22 | I2C SCL | Also available on P3, can be used for SPI SCK |
| IO27 | I2C SDA | Can be used for SPI MOSI |
| 3.3V | Power | |

**Ideal for:** I2C devices with proper external pull-up resistors (4.7kΩ)

### P1 Connector (4P 1.25mm JST) - Serial

| Pin | Function | Notes |
|-----|----------|-------|
| VIN | Power In | 5V input for external power |
| IO1 | TX | UART0 TX, can be used as GPIO (advanced) |
| IO3 | RX | UART0 RX, can be used as GPIO (advanced) |
| GND | Ground | |

### Speaker Connector (2P 1.25mm JST)

| Pin | Function | Notes |
|-----|----------|-------|
| IO26 | Audio | Connected to amplifier, I2S DAC mode |
| GND | Ground | |

**Usage:**
```cpp
i2s_set_dac_mode(I2S_DAC_CHANNEL_LEFT_EN);
```

## Onboard Peripherals

### RGB LED

**Configuration:** Active LOW (HIGH = off, LOW = on)

| Pin | Color |
|-----|-------|
| IO4 | Red |
| IO16 | Green |
| IO17 | Blue |

**Example:**
```cpp
#define LED_RED   4
#define LED_GREEN 16
#define LED_BLUE  17

void setup() {
  pinMode(LED_RED, OUTPUT);
  pinMode(LED_GREEN, OUTPUT);
  pinMode(LED_BLUE, OUTPUT);
  
  // Turn on red (active LOW)
  digitalWrite(LED_RED, LOW);
  digitalWrite(LED_GREEN, HIGH);
  digitalWrite(LED_BLUE, HIGH);
}
```

### TFT Display (ILI9341)

**Uses HSPI interface**

| Pin | Function |
|-----|----------|
| IO2 | TFT_RS (DC) |
| IO12 | TFT_SDO (MISO) |
| IO13 | TFT_SDI (MOSI) |
| IO14 | TFT_SCK |
| IO15 | TFT_CS |
| IO21 | TFT_BL (Backlight) |

**Library:** TFT_eSPI (requires configuration)

**Important:** IO21 also appears on P3 connector but controls backlight

### Touch Screen (XPT2046)

| Pin | Function |
|-----|----------|
| IO25 | XPT2046_CLK |
| IO32 | XPT2046_MOSI |
| IO33 | XPT2046_CS |
| IO36 | XPT2046_IRQ |
| IO39 | XPT2046_MISO |

### SD Card (VSPI)

| Pin | Function |
|-----|----------|
| IO5 | SS (Chip Select) |
| IO18 | SCK |
| IO19 | MISO |
| IO23 | MOSI |

### Light Sensor (LDR)

| Pin | Function |
|-----|----------|
| IO34 | ADC | Input-only pin |

### Buttons

| Pin | Function | Notes |
|-----|----------|-------|
| IO0 | BOOT | Can be used as input in sketches |
| EN | RESET | Hardware reset |

## Pin Availability Summary

### Easily Accessible GPIO

Only **3 pins** are easily accessible for general use:

1. **IO35** (P3) - Input only, no pull-ups
2. **IO22** (P3 and CN1)
3. **IO27** (CN1)

### Additional GPIO (Sacrificing Peripherals)

If you need more pins, consider:

**RGB LED pins** (if LED not needed):
- IO4 (Red)
- IO16 (Green)
- IO17 (Blue)

**SD Card pins** (if SD card not needed):
- IO5 (CS)
- IO18 (SCK)
- IO19 (MISO)
- IO23 (MOSI)

## Power Supply

### USB Power
- Dual USB ports (USB-C and Micro USB)
- Both ports provide 5V power

### External Power (P1 Connector)
- VIN pin accepts 5V input
- Use for battery or external power supply

### Test Points

| Label | Function | Location |
|-------|----------|----------|
| S1 | GND | Near USB-SERIAL |
| S2 | 3.3V | For ESP32 |
| S3 | 5V | Near USB-SERIAL |
| S4 | GND | For ESP32 |
| S5 | 3.3V | For TFT |
| JP0 (near USB) | 5V | TFT LDO input |
| JP0 (far) | 3.3V | TFT LDO output |
| JP3 (near USB) | 5V | ESP32 LDO input |
| JP3 (far) | 3.3V | ESP32 LDO output |

## TFT_eSPI Configuration

For CYD, configure `User_Setup.h`:

```cpp
#define ILI9341_DRIVER

#define TFT_MISO 12
#define TFT_MOSI 13
#define TFT_SCLK 14
#define TFT_CS   15
#define TFT_DC   2
#define TFT_RST  -1  // Connected to ESP32 EN

#define TFT_BL   21
#define TFT_BACKLIGHT_ON HIGH

// Color order (may vary by version)
#define TFT_RGB_ORDER TFT_BGR  // Or TFT_RGB for some versions

// Inversion (required for some CYD v3 boards)
#define TFT_INVERSION_ON  // Or TFT_INVERSION_OFF
```

## Common CYD Issues

### Display Shows Inverted Colors
- Try changing `TFT_RGB_ORDER` between `TFT_BGR` and `TFT_RGB`
- Try toggling `TFT_INVERSION_ON` / `TFT_INVERSION_OFF`

### Watchdog Resets
- Set Arduino IDE: "Events Run On: Core 0" and "Arduino Runs On: Core 1"

### Touch Not Responding
- Check SPI bus conflicts
- Ensure touch initialization after display initialization

### Random Resets
- Check power supply (may need external 5V, 1A+ supply)
- Add bulk capacitors (100-1000µF) near power pins

## Example Wiring for External Devices

### Example: MFRC522 RFID + 18650 Battery Shield + Speaker

**MFRC522 (SPI device) on CN1:**
- SDA (CS): Use separate GPIO (e.g., IO27)
- SCK: IO22 (CN1)
- MOSI: IO27 → Need to reassign! Use different pin
- MISO: IO35 (P3)
- GND: GND (CN1)
- 3.3V: 3.3V (CN1)

**Note:** This configuration has conflicts. Better approach:

**Option 1: Use SD card SPI pins (if SD not needed)**
- SCK: IO18
- MOSI: IO23
- MISO: IO19
- CS: IO5 (or any available GPIO)

**Option 2: Software SPI on available pins**
- More flexible but slower

### I2C Device on CN1

```cpp
#include <Wire.h>

#define I2C_SDA 27
#define I2C_SCL 22

void setup() {
  Wire.begin(I2C_SDA, I2C_SCL);
  // Use I2C device
}
```

**Remember:** Add external 4.7kΩ pull-up resistors on SDA and SCL!

## Pin Assignment Best Practices for CYD

1. **For I2C devices:** Use CN1 connector (IO22 = SCL, IO27 = SDA)
2. **For additional SPI devices:** Use VSPI pins (sacrifice SD card if not needed)
3. **For simple inputs:** Use IO35 (with external pull resistor) or IO22/IO27
4. **For outputs:** Sacrifice RGB LED pins (IO4, IO16, IO17) if not needed
5. **For analog input:** Use IO34 (LDR pin if light sensor not needed) or IO35

## Quick Reference: What's Actually Available

**Without sacrificing anything:**
- IO22 (can be I2C SCL or general GPIO)
- IO27 (can be I2C SDA or general GPIO)
- IO35 (input only, requires external pull resistor)

**If you sacrifice RGB LED:**
- +3 pins: IO4, IO16, IO17

**If you sacrifice SD card:**
- +4 pins: IO5, IO18, IO19, IO23

**Total realistically available:** 3-10 pins depending on what you sacrifice

## Next Steps

- See **hardware_constraints.md** for ESP32 GPIO limitations
- See **communication_interfaces.md** for SPI/I2C configuration
- See **getting_started.md** for Arduino CLI workflow
